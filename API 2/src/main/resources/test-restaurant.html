<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Borne de Commande Interactive</title>
    <style>
        :root { --primary: #f39c12; --dark: #2c3e50; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); }

        /* Cat√©gories */
        .sidebar { width: 100px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; align-items: center; padding-top: 20px; }
        .cat-btn { background: none; border: none; margin-bottom: 25px; cursor: pointer; font-weight: bold; color: var(--dark); }
        .cat-btn span { font-size: 2.5em; display: block; }

        /* Grille produits */
        .content { flex: 1; padding: 20px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card { background: white; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; }
        .card:active { transform: scale(0.95); }
        .card .price { color: var(--primary); font-weight: bold; font-size: 1.2em; margin-top: 8px; }

        /* Panier */
        .cart { width: 320px; background: white; border-left: 1px solid #ddd; display: flex; flex-direction: column; }
        .cart-title { padding: 20px; background: var(--dark); color: white; margin: 0; }
        .cart-items { flex: 1; padding: 15px; overflow-y: auto; }
        .item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .qty-controls button { padding: 2px 8px; cursor: pointer; }
        .footer { padding: 20px; border-top: 2px solid #eee; }
        .btn-order { background: var(--primary); color: white; border: none; width: 100%; padding: 15px; border-radius: 8px; font-size: 1.2em; cursor: pointer; }
    </style>
</head>
<body>

<div class="sidebar">
    <button class="cat-btn" onclick="filterCat('')"><span>üç¥</span>Tous</button>
    <button class="cat-btn" onclick="filterCat('Entr√©e')"><span>ü•ó</span>Entr√©es</button>
    <button class="cat-btn" onclick="filterCat('Plat')"><span>üçî</span>Plats</button>
    <button class="cat-btn" onclick="filterCat('Dessert')"><span>üç∞</span>Desserts</button>
    <button class="cat-btn" onclick="filterCat('Boisson')"><span>ü•§</span>Boissons</button>
</div>

<div class="content">
    <h1 id="catTitle">La Carte</h1>
    <div class="grid" id="productsGrid"></div>
</div>

<div class="cart">
    <h2 class="cart-title">Mon Panier</h2>
    <div class="cart-items" id="cartList"></div>
    <div class="footer">
        <div style="display:flex; justify-content:space-between; font-size:1.5em; margin-bottom:15px;">
            <span>Total</span><span id="totalTxt">0.00‚Ç¨</span>
        </div>
        <button class="btn-order" onclick="sendOrder()">VALIDER</button>
    </div>
</div>

<script>
    const API = "http://localhost:7001";
    let menu = [], cart = [];

    async function init() {
        const r = await fetch(`${API}/menu`);
        menu = await r.json();
        render(menu);
    }

    function render(items) {
        document.getElementById('productsGrid').innerHTML = items.map(i => `
            <div class="card" onclick="addToCart(${i.id}, '${i.name}', ${i.price})">
                <div style="font-size:3em">${getEmoji(i.category)}</div>
                <strong>${i.name}</strong>
                <div class="price">${i.price.toFixed(2)}‚Ç¨</div>
            </div>
        `).join('');
    }

    function getEmoji(c) {
        return c==='Entr√©e'?'ü•ó':c==='Plat'?'üçî':c==='Dessert'?'üç∞':'ü•§';
    }

    function filterCat(c) {
        document.getElementById('catTitle').innerText = c || "La Carte";
        render(c ? menu.filter(m => m.category === c) : menu);
    }

    function addToCart(id, name, price) {
        const item = cart.find(i => i.id === id);
        if(item) item.qty++; else cart.push({id, name, price, qty: 1});
        updateCart();
    }

    function updateCart() {
        document.getElementById('cartList').innerHTML = cart.map((i, idx) => `
            <div class="item">
                <div><strong>${i.name}</strong><br>${i.price.toFixed(2)}‚Ç¨</div>
                <div class="qty-controls">
                    <button onclick="changeQty(${idx},-1)">-</button>
                    <strong> ${i.qty} </strong>
                    <button onclick="changeQty(${idx},1)">+</button>
                </div>
            </div>
        `).join('');
        const total = cart.reduce((s, i) => s + (i.price * i.qty), 0);
        document.getElementById('totalTxt').innerText = total.toFixed(2) + "‚Ç¨";
    }

    function changeQty(idx, d) {
        cart[idx].qty += d;
        if(cart[idx].qty <= 0) cart.splice(idx, 1);
        updateCart();
    }

    async function sendOrder() {
        if(!cart.length) return;
        const ids = [];
        cart.forEach(i => { for(let n=0; n<i.qty; n++) ids.push(i.id); });

        await fetch(`${API}/orders`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ tableNumber: 99, dishIds: ids })
        });
        alert("Commande envoy√©e !");
        cart = []; updateCart();
    }

    init();
</script>
</body>
</html>